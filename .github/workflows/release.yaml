name: release pipe

env:
  ARTIFACTORY_URL: "https://scribesecuriy.jfrog.io"
  RELEASE_ARTIFACTORY_USERNAME: mikey@scribesecurity.com

on: 
  push:
    tags:
      - '*'
    branches: [main]
  workflow_dispatch:

jobs:
  release:
    runs-on: ubuntu-20.04
    defaults:
      run:
        shell: bash
    steps:
    
      - uses: actions/checkout@v3

      - name: Mirror bitbucket
        uses: pixta-dev/repository-mirroring-action@v1
        with:
          target_repo_url:
            git@bitbucket.org:guycherno/integrations.git
          ssh_private_key:                           
            ${{ secrets.BITBUCKET_SSH_KEY }}

      # - name: Login to GitHub Container Registry
      #   uses: docker/login-action@v2
      #   with:
      #     registry: ${{ env.ARTIFACTORY_URL }}
      #     username: ${{ secrets.RELEASE_ARTIFACTORY_USERNAME }}
      #     password: ${{ secrets.RELEASE_ARTIFACTORY_TOKEN }}
      
      # - name: Release Build
      #   run: |
      #     docker build -t scribesecuriy.jfrog.io/scribe-docker-public-local/valint-pipe:${GITHUB_REF#refs/*/} -t scribesecuriy.jfrog.io/scribe-docker-public-local/valint-pipe:latest .

      # - name: Pre-release Build
      #   run: |
      #     docker build -t scribesecuriy.jfrog.io/scribe-docker-public-local/valint-pipe:${GITHUB_REF#refs/*/} -t scribesecuriy.jfrog.io/scribe-docker-public-local/valint-pipe:dev-latest -f Dockerfile_pre .

      # - name: publish release artifacts
      #   run: |
      #     docker push scribesecuriy.jfrog.io/scribe-docker-public-local/valint-pipe --all-tags